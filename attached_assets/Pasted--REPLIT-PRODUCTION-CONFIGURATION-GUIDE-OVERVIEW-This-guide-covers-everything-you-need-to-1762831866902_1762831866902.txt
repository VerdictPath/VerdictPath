# ðŸš€ REPLIT PRODUCTION CONFIGURATION GUIDE

## ðŸ“‹ OVERVIEW

This guide covers everything you need to configure Verdict Path for production deployment on Replit.

---

## âš¡ QUICK START CHECKLIST

- [ ] Replit account created
- [ ] Backend code uploaded to Replit
- [ ] Database schema installed
- [ ] Environment variables configured
- [ ] Backend running successfully
- [ ] Frontend connected to backend
- [ ] All features tested
- [ ] Ready to launch!

---

## ðŸ”§ STEP 1: REPLIT SETUP (10 minutes)

### **1.1 Create Replit Project**

1. Go to https://replit.com
2. Click "Create Repl"
3. Choose "Node.js" template
4. Name it (e.g., "verdictpath-backend")
5. Click "Create Repl"

### **1.2 Upload Your Backend Code**

**Option A: Upload Files**
1. Click the three dots (â€¢â€¢â€¢) next to "Files"
2. Select "Upload folder" or "Upload file"
3. Upload all your backend files

**Option B: Use Git**
1. In Replit Shell, run:
```bash
git clone https://github.com/your-username/your-repo.git
mv your-repo/* .
rm -rf your-repo
```

**Files to upload:**
```
backend/
â”œâ”€â”€ server.js (or app.js)
â”œâ”€â”€ package.json
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ backend-core-api-routes.js
â”‚   â”œâ”€â”€ backend-litigation-api-routes.js
â”‚   â”œâ”€â”€ backend-stripe-subscriptions.js
â”‚   â”œâ”€â”€ backend-file-uploads.js
â”‚   â”œâ”€â”€ backend-push-notifications.js
â”‚   â””â”€â”€ backend-negotiations-routes.js
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.js
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js
â”œâ”€â”€ firebase-service-account.json (if using Firebase)
â””â”€â”€ .gitignore
```

### **1.3 Install Dependencies**

In Replit Shell:
```bash
npm install
```

Or click "Packages" icon (ðŸ“¦) and search/install:
- express
- bcryptjs
- jsonwebtoken
- pg
- stripe
- multer
- cloudinary
- multer-storage-cloudinary
- firebase-admin
- dotenv
- cors
- helmet

---

## ðŸ’¾ STEP 2: DATABASE SETUP (15 minutes)

### **2.1 Enable PostgreSQL**

1. Click "Database" icon (ðŸ—„ï¸) in left sidebar
2. Click "PostgreSQL"
3. Click "Create database"
4. Wait for provisioning (2-3 minutes)
5. Copy the connection string shown

**Connection string format:**
```
postgresql://username:password@hostname:5432/database_name
```

### **2.2 Run Database Schema**

**Method 1: Replit Database Tool**
1. Click "Database" tab
2. Click "Console"
3. Paste contents of `complete-database-schema.sql`
4. Click "Run"

**Method 2: Replit Shell**
```bash
# Save your connection string
export DATABASE_URL="postgresql://..."

# Run schema
psql $DATABASE_URL -f complete-database-schema.sql
```

**Method 3: External Tool (TablePlus, pgAdmin)**
1. Use the connection string from Replit
2. Connect with your preferred PostgreSQL client
3. Run the schema file

### **2.3 Verify Database**

In Replit Shell:
```bash
psql $DATABASE_URL -c "\dt"
```

You should see all your tables listed:
- clients
- law_firms
- medical_providers
- coin_balances
- coin_transactions
- litigation_progress
- etc.

---

## ðŸ” STEP 3: ENVIRONMENT VARIABLES (20 minutes)

### **3.1 Access Replit Secrets**

1. Click the lock icon (ðŸ”’) "Secrets" in left sidebar
2. Click "Open raw editor" (optional - easier for bulk entry)

### **3.2 Add Required Variables**

Copy from `ENVIRONMENT-VARIABLES-TEMPLATE.md` and add each:

**Critical Variables (MUST ADD):**
```
DATABASE_URL=postgresql://... (from Step 2.1)
JWT_SECRET=generate_random_64_character_string
STRIPE_SECRET_KEY=sk_test_... (from Stripe Dashboard)
STRIPE_WEBHOOK_SECRET=whsec_... (DevOp will provide)
STRIPE_PRICE_INDIVIDUAL_BASIC=price_...
STRIPE_PRICE_INDIVIDUAL_PREMIUM=price_...
STRIPE_PRICE_LAWFIRM_BASIC=price_...
STRIPE_PRICE_LAWFIRM_PREMIUM=price_...
STRIPE_PRICE_PROVIDER_BASIC=price_...
STRIPE_PRICE_PROVIDER_PREMIUM=price_...
UPLOAD_PROVIDER=cloudinary
CLOUDINARY_CLOUD_NAME=...
CLOUDINARY_API_KEY=...
CLOUDINARY_API_SECRET=...
FIREBASE_PROJECT_ID=...
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=...
NODE_ENV=production
PORT=3001
FRONTEND_URL=https://your-app-url.com
```

### **3.3 Generate JWT Secret**

In Replit Shell:
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

Copy the output and add to Secrets as `JWT_SECRET`

### **3.4 Verify Secrets**

In Replit Shell:
```bash
node -e "console.log('DATABASE_URL:', process.env.DATABASE_URL ? 'âœ…' : 'âŒ')"
node -e "console.log('JWT_SECRET:', process.env.JWT_SECRET ? 'âœ…' : 'âŒ')"
node -e "console.log('STRIPE_SECRET_KEY:', process.env.STRIPE_SECRET_KEY ? 'âœ…' : 'âŒ')"
```

---

## ðŸ”¥ STEP 4: START SERVER (5 minutes)

### **4.1 Update package.json**

Make sure your `package.json` has a start script:

```json
{
  "name": "verdictpath-backend",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.0",
    "pg": "^8.11.0",
    "stripe": "^12.0.0",
    "multer": "^1.4.5-lts.1",
    "cloudinary": "^1.36.0",
    "multer-storage-cloudinary": "^4.0.0",
    "firebase-admin": "^11.8.0",
    "dotenv": "^16.0.3",
    "cors": "^2.8.5",
    "helmet": "^7.0.0"
  }
}
```

### **4.2 Start the Server**

Click the big green "Run" button at the top of Replit!

Or in Shell:
```bash
npm start
```

### **4.3 Check Console Output**

You should see:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Verdict Path API Server Running    â•‘
â•‘   Port: 3001                          â•‘
â•‘   Environment: production             â•‘
â•‘   Database: Connected âœ“               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### **4.4 Test Health Endpoint**

Click the URL at the top of Replit (looks like: https://verdictpath-backend.username.repl.co)

Add `/health` to the URL:
```
https://your-app.repl.co/health
```

Should return:
```json
{
  "status": "ok",
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

---

## ðŸŒ STEP 5: CONFIGURE FRONTEND CONNECTION (10 minutes)

### **5.1 Get Your Replit URL**

Your backend URL format:
```
https://[repl-name].[username].repl.co
```

Example:
```
https://verdictpath-backend.johndoe.repl.co
```

### **5.2 Update Frontend API Config**

In your React Native app, update `/src/config/api.js`:

```javascript
// Replace this line:
export const API_BASE_URL = 'https://your-replit-username-your-project-name.replit.app';

// With your actual URL:
export const API_BASE_URL = 'https://verdictpath-backend.johndoe.repl.co';
```

### **5.3 Update CORS in Backend**

In your `server.js`, update CORS configuration:

```javascript
app.use(cors({
  origin: [
    'http://localhost:3000', // Local development
    'https://your-frontend-url.com', // Production frontend
    // Add any other domains that need access
  ],
  credentials: true
}));
```

### **5.4 Test Connection**

In your React Native app:
1. Try registering a new user
2. Check Replit console for logs
3. Verify user appears in database
4. Try logging in
5. Test coin balance, etc.

---

## ðŸ”’ STEP 6: SECURITY CONFIGURATION (15 minutes)

### **6.1 Enable Always-On (REQUIRED for Production)**

Free Repls sleep after inactivity. For production:

1. Go to your Repl page
2. Click "Repl settings" (âš™ï¸)
3. Under "Always On", toggle ON
4. This requires Replit Hacker plan ($7/month)

**Why needed:**
- âœ… Server stays running 24/7
- âœ… No cold starts
- âœ… Webhooks work reliably
- âœ… Users can access anytime

### **6.2 Configure Security Headers**

Already in your code via Helmet:
```javascript
app.use(helmet());
```

Verify it's working:
```bash
curl -I https://your-app.repl.co/health
```

Should see headers like:
```
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
```

### **6.3 Enable Rate Limiting**

Already configured in your code:
```javascript
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100 // limit each IP to 100 requests per window
});

app.use('/api/auth', limiter);
```

### **6.4 Setup HTTPS (Automatic)**

Replit provides HTTPS automatically! âœ…
Your URLs will be: `https://...` (not http)

### **6.5 Add .gitignore**

Create `.gitignore` file:
```
node_modules/
.env
firebase-service-account.json
*.log
.DS_Store
.replit
.config/
```

---

## ðŸ“Š STEP 7: MONITORING & LOGGING (10 minutes)

### **7.1 Enable Replit Console Logging**

Your server.js should have:
```javascript
// Log all requests
app.use((req, res, next) => {
  console.log(`${req.method} ${req.path}`);
  next();
});

// Error logging
app.use((err, req, res, next) => {
  console.error('Error:', err);
  res.status(500).json({ error: 'Internal server error' });
});
```

### **7.2 Setup Sentry (Optional but Recommended)**

1. Sign up at https://sentry.io (free tier)
2. Create Node.js project
3. Get DSN
4. Add to Replit Secrets: `SENTRY_DSN=...`
5. Install: `npm install @sentry/node`
6. Add to server.js:

```javascript
const Sentry = require('@sentry/node');

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV
});

// Error handler
app.use(Sentry.Handlers.errorHandler());
```

### **7.3 Monitor Replit Dashboard**

Check regularly:
- CPU usage
- Memory usage
- Network traffic
- Error logs

---

## ðŸ”„ STEP 8: BACKUP & RECOVERY (10 minutes)

### **8.1 Database Backups**

**Option 1: Replit Automatic Backups**
- Replit Pro includes automatic database backups
- Upgrade to access this feature

**Option 2: Manual Backups**
```bash
# In Replit Shell
pg_dump $DATABASE_URL > backup-$(date +%Y%m%d).sql
```

**Option 3: Schedule Backups**
Create a cron job or use external service.

### **8.2 Code Backups**

**Option 1: Git**
```bash
git init
git add .
git commit -m "Production version"
git remote add origin https://github.com/your-username/your-repo.git
git push -u origin main
```

**Option 2: Replit History**
Replit keeps version history automatically.
Click "History" in left sidebar to restore previous versions.

### **8.3 Environment Variables Backup**

1. Export all secrets from Replit
2. Save in password manager (1Password, LastPass, etc.)
3. Store securely offline
4. NEVER commit to Git!

---

## ðŸš€ STEP 9: PERFORMANCE OPTIMIZATION (15 minutes)

### **9.1 Database Connection Pooling**

In `config/database.js`:
```javascript
const { Pool } = require('pg');

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: 20, // Maximum number of clients in pool
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
});

module.exports = {
  query: (text, params) => pool.query(text, params),
  pool
};
```

### **9.2 Enable Compression**

Install and enable:
```bash
npm install compression
```

In server.js:
```javascript
const compression = require('compression');
app.use(compression());
```

### **9.3 Add Response Caching (Optional)**

For frequently requested data:
```javascript
const cache = {};

app.get('/api/coins/balance', authenticateToken, async (req, res) => {
  const cacheKey = `balance_${req.user.id}`;
  
  // Check cache
  if (cache[cacheKey] && Date.now() - cache[cacheKey].timestamp < 60000) {
    return res.json(cache[cacheKey].data);
  }
  
  // Fetch from database
  const result = await db.query('SELECT balance FROM coin_balances WHERE user_id = $1', [req.user.id]);
  
  // Cache result
  cache[cacheKey] = {
    data: { balance: result.rows[0].balance },
    timestamp: Date.now()
  };
  
  res.json(cache[cacheKey].data);
});
```

### **9.4 Database Indexes**

Already included in schema! âœ…
Verify they're created:
```sql
SELECT indexname FROM pg_indexes WHERE tablename = 'clients';
```

---

## ðŸ“± STEP 10: FINAL CHECKS (10 minutes)

### **10.1 Test All Endpoints**

Use Postman or curl to test:
- [ ] Registration works
- [ ] Login works
- [ ] Coin operations work
- [ ] File uploads work
- [ ] Litigation progress works
- [ ] Law firm features work
- [ ] Stripe checkout works
- [ ] Notifications work

### **10.2 Load Testing (Optional)**

Use tools like Apache Bench:
```bash
ab -n 1000 -c 10 https://your-app.repl.co/health
```

Target: Handle 100+ requests/second

### **10.3 Security Scan**

Use tools like:
- OWASP ZAP
- Snyk (npm audit)
- Replit Security tab

```bash
npm audit
npm audit fix
```

### **10.4 Performance Check**

- [ ] Health endpoint responds < 100ms
- [ ] Login endpoint responds < 500ms
- [ ] Data queries respond < 1s
- [ ] File uploads show progress
- [ ] No memory leaks

---

## ðŸŽ‰ STEP 11: GO LIVE! (5 minutes)

### **11.1 Switch to Production Mode**

In Replit Secrets:
```
NODE_ENV=production
STRIPE_SECRET_KEY=sk_live_... (change from test to live)
```

### **11.2 Update Frontend**

Point frontend to production URL:
```javascript
export const API_BASE_URL = 'https://your-app.repl.co';
```

### **11.3 Final Smoke Test**

1. Register a real user
2. Complete a real transaction
3. Upload a real file
4. Verify everything works

### **11.4 Monitor Closely**

Watch Replit console for:
- Errors
- Slow requests
- High memory usage
- Database issues

---

## ðŸ”§ TROUBLESHOOTING

### **Server Won't Start**
```bash
# Check logs in Replit Console
# Verify all environment variables set
# Check package.json dependencies installed
npm install
```

### **Database Connection Failed**
```bash
# Verify DATABASE_URL is correct
echo $DATABASE_URL
# Test connection
psql $DATABASE_URL -c "SELECT 1"
```

### **Endpoints Return 404**
- Check routes are registered in server.js
- Verify file paths are correct
- Check console for route loading errors

### **Cors Errors**
- Add frontend URL to cors config
- Verify origin is set correctly
- Check browser console for specific error

### **High Memory Usage**
- Check for memory leaks
- Reduce connection pool size
- Clear caches periodically
- Restart Repl

### **Slow Performance**
- Add database indexes
- Enable compression
- Optimize queries
- Upgrade Replit plan

---

## ðŸ’° COST BREAKDOWN

**Free Tier:**
- âœ… Basic Repl
- âœ… 1 GB storage
- âœ… Basic database
- âŒ Sleeps after inactivity
- âŒ Limited compute

**Hacker Plan ($7/month):**
- âœ… Always-On Repls
- âœ… 5 GB storage
- âœ… 2 GB RAM
- âœ… Private Repls
- âœ… Priority support

**Pro Plan ($20/month):**
- âœ… Everything in Hacker
- âœ… 10 GB storage
- âœ… 4 GB RAM
- âœ… Ghostwriter AI
- âœ… Database backups

**For MVP Launch:** Hacker Plan recommended minimum

---

## ðŸ“Š REPLIT ALTERNATIVES

If you outgrow Replit:

**Railway** - Similar to Replit, good pricing
**Render** - Free tier, easy deploys
**Heroku** - Industry standard, more expensive
**DigitalOcean** - More control, requires setup
**AWS Elastic Beanstalk** - Enterprise scale

---

## ðŸŽ¯ PRODUCTION CHECKLIST

- [ ] Code uploaded to Replit
- [ ] Database created and schema installed
- [ ] All environment variables configured
- [ ] Server starts successfully
- [ ] Health endpoint responds
- [ ] Frontend connected to backend
- [ ] All endpoints tested
- [ ] Stripe webhooks configured
- [ ] Push notifications working
- [ ] File uploads working
- [ ] Always-On enabled (Hacker plan)
- [ ] HTTPS working (automatic)
- [ ] CORS configured
- [ ] Security headers enabled
- [ ] Rate limiting active
- [ ] Error logging configured
- [ ] Database backups scheduled
- [ ] Code backed up to Git
- [ ] Monitoring active
- [ ] Performance acceptable
- [ ] Security scan passed
- [ ] Load testing done
- [ ] Ready to launch! ðŸš€

---

## ðŸ“ž SUPPORT

**Replit Docs:** https://docs.replit.com
**Replit Community:** https://replit.com/community
**Your Backend:** Check Replit Console logs

---

**Congratulations! Your backend is production-ready! ðŸŽ‰**