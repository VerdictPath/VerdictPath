# Medical Calendar System Implementation Guide
## Verdict Path - Complete Technical Implementation

---

## üì¶ Package Dependencies

Add these to your `package.json`:

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "pg": "^8.11.3",
    "nodemailer": "^6.9.7",
    "twilio": "^4.19.0",
    "ical": "^0.8.0",
    "moment": "^2.29.4",
    "moment-timezone": "^0.5.43",
    "react": "18.2.0",
    "react-native": "0.72.0",
    "react-native-calendars": "^1.1300.0",
    "react-native-vector-icons": "^10.0.0",
    "react-native-document-picker": "^9.0.1"
  }
}
```

Install with:
```bash
npm install
```

---

## üóÑÔ∏è Database Setup

### 1. Run the Database Schema

Execute the SQL schema file against your PostgreSQL database:

```bash
psql -U your_username -d verdict_path -f medical-calendar-schema.sql
```

Or in your existing migration system, add the schema as a new migration.

### 2. Verify Tables Created

Check that these tables exist:
- `provider_availability`
- `provider_blocked_times`
- `medical_appointments`
- `calendar_sync_settings`
- `calendar_import_history`
- `appointment_reschedule_history`

---

## ‚öôÔ∏è Backend Setup

### 1. Environment Variables

Add to your `.env` file:

```env
# Database
DATABASE_URL=postgresql://user:password@host:port/verdict_path

# Email (Gmail example)
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-specific-password

# Twilio SMS
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# API Base URL
API_URL=https://your-api-domain.com
```

### 2. Integrate API Routes

In your main Express app file (e.g., `server.js` or `app.js`):

```javascript
const medicalCalendarRoutes = require('./medical-calendar-api');

// Add the routes
app.use(medicalCalendarRoutes);
```

### 3. Email Configuration

For Gmail, you need to:
1. Enable 2-factor authentication
2. Generate an app-specific password
3. Use that password in `EMAIL_PASS`

For other providers (SendGrid, Mailgun, etc.), adjust the transporter configuration in the API file.

---

## üì± React Native Frontend Setup

### 1. Install Required Native Modules

```bash
# React Native Calendars
npm install react-native-calendars

# Vector Icons
npm install react-native-vector-icons
npx react-native link react-native-vector-icons

# Document Picker (for calendar imports)
npm install react-native-document-picker
```

### 2. iOS Setup (if applicable)

```bash
cd ios && pod install && cd ..
```

Update `ios/YourApp/Info.plist`:
```xml
<key>UIAppFonts</key>
<array>
  <string>MaterialCommunityIcons.ttf</string>
</array>
```

### 3. Android Setup (if applicable)

In `android/app/build.gradle`:
```gradle
apply from: "../../node_modules/react-native-vector-icons/fonts.gradle"
```

---

## üîó Integration Steps

### 1. Add Calendar Components to Your Navigation

In your navigation setup:

```javascript
// For Medical Providers
import MedicalProviderCalendar from './MedicalProviderCalendar';

<Stack.Screen 
  name="ProviderCalendar" 
  component={MedicalProviderCalendar}
  options={{ headerShown: false }}
/>

// For Patients
import PatientAppointmentBooking from './PatientAppointmentBooking';

<Stack.Screen 
  name="BookAppointment" 
  component={PatientAppointmentBooking}
  options={{ headerShown: false }}
/>

// For Law Firms
import LawFirmClientAppointments from './LawFirmClientAppointments';

<Stack.Screen 
  name="ClientAppointments" 
  component={LawFirmClientAppointments}
  options={{ headerShown: false }}
/>
```

### 2. Navigate to Calendar Features

From medical provider dashboard:
```javascript
navigation.navigate('ProviderCalendar', { 
  providerId: currentProvider.id 
});
```

From patient case view:
```javascript
navigation.navigate('BookAppointment', {
  patientId: currentPatient.id,
  providerId: selectedProvider.id,
  caseId: currentCase.id,
  lawFirmId: connectedLawFirm.id
});
```

From law firm client view:
```javascript
navigation.navigate('ClientAppointments', {
  lawFirmId: currentLawFirm.id,
  clientId: selectedClient.id
});
```

---

## üé® Customization

### Pirate Theme Colors

The components use your established Verdict Path color scheme:

```javascript
const colors = {
  primary: '#1a5490',      // Navy blue
  secondary: '#0d2f54',     // Darker navy
  accent: '#FFD700',        // Gold
  success: '#10b981',       // Green
  warning: '#f59e0b',       // Orange
  error: '#ef4444',         // Red
  background: '#0a1628'     // Dark background
};
```

To adjust colors, search for these hex codes in the component files.

### Glass Morphism Effect

The glass morphism is achieved with:
```javascript
backgroundColor: 'rgba(255, 255, 255, 0.05)',
borderWidth: 1,
borderColor: 'rgba(255, 215, 0, 0.2)'
```

Adjust the alpha values (0.05, 0.2) for more or less transparency.

---

## üìÖ Calendar Import Feature

### Supporting .ics File Imports

The system supports importing calendar files from:
- Google Calendar
- Outlook/Microsoft Calendar  
- Apple Calendar

To enable full document picking:

```javascript
import DocumentPicker from 'react-native-document-picker';

const pickCalendarFile = async () => {
  try {
    const result = await DocumentPicker.pick({
      type: [DocumentPicker.types.allFiles],
    });
    
    const fileContent = await RNFS.readFile(result.uri, 'utf8');
    
    // Send to API
    const response = await fetch(
      `${API_URL}/api/providers/${providerId}/import-calendar`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          icsContent: fileContent,
          fileName: result.name
        })
      }
    );
  } catch (err) {
    console.error(err);
  }
};
```

---

## üîî Notification System

### Email Notifications

Templates are included in the API file. Customize the email HTML in:
- `generatePatientEmail()`
- `generateProviderEmail()`
- `generateLawFirmEmail()`

### SMS Notifications

Twilio integration is included. Messages are sent via:
- `sendAppointmentNotifications()` function

Customize SMS text in:
- `generatePatientSMS()` function

---

## üß™ Testing

### 1. Test Database Connection

```javascript
const { Pool } = require('pg');
const pool = new Pool({ connectionString: process.env.DATABASE_URL });

pool.query('SELECT NOW()', (err, res) => {
  console.log(err, res);
  pool.end();
});
```

### 2. Test API Endpoints

```bash
# Create availability
curl -X POST http://localhost:3000/api/providers/1/availability \
  -H "Content-Type: application/json" \
  -d '{"dayOfWeek": 1, "startTime": "09:00", "endTime": "17:00", "isRecurring": true}'

# Get available slots
curl http://localhost:3000/api/providers/1/available-slots?date=2024-01-15

# Create appointment
curl -X POST http://localhost:3000/api/appointments \
  -H "Content-Type: application/json" \
  -d '{
    "patientId": 1,
    "providerId": 1,
    "appointmentDate": "2024-01-15",
    "startTime": "10:00",
    "endTime": "10:30",
    "appointmentType": "Initial Consultation"
  }'
```

### 3. Test Components

Use React Native debugging:
```bash
npx react-native start
```

---

## üöÄ Deployment Checklist

- [ ] Database schema applied to production database
- [ ] Environment variables set in production
- [ ] Email service configured and tested
- [ ] Twilio account configured with production credentials
- [ ] API endpoints deployed and accessible
- [ ] Frontend components integrated into navigation
- [ ] Icons and fonts properly linked
- [ ] Notifications tested with real email/phone numbers
- [ ] Calendar import tested with real .ics files
- [ ] Time zone handling verified
- [ ] Multi-portal synchronization tested

---

## üìä Key Features Implemented

‚úÖ **Provider Portal:**
- Visual calendar with month/week/day views
- Set recurring availability patterns
- Block time for vacations/conferences
- Import existing calendars (.ics)
- View and manage appointments
- Email and SMS notifications

‚úÖ **Patient Portal:**
- Browse provider availability
- Select date and time slots
- Book appointments with notes
- View upcoming appointments
- Cancel appointments
- Receive confirmations

‚úÖ **Law Firm Portal:**
- View all client medical appointments
- Calendar and list views
- Multi-client selector
- Track appointment statuses
- Integration with case timeline

‚úÖ **Synchronization:**
- Real-time updates across all three portals
- Email notifications to all parties
- SMS confirmations
- Status tracking (pending/confirmed/cancelled)

---

## üêõ Troubleshooting

### Calendar Not Showing
- Check that `react-native-calendars` is properly installed
- Verify no conflicting date library versions
- Check console for import errors

### Notifications Not Sending
- Verify email credentials in `.env`
- Check Twilio account SID and auth token
- Ensure phone numbers are in E.164 format (+1234567890)

### Database Errors
- Verify connection string in `DATABASE_URL`
- Check that all migrations have run
- Ensure PostgreSQL version compatibility (12+)

### Time Zone Issues
- Set provider timezone in `calendar_sync_settings`
- Use moment-timezone for all date calculations
- Store all times in UTC in database

---

## üìû Support

For issues specific to Verdict Path integration, check:
1. Component props match your user/provider/firm ID structure
2. API endpoints return data in expected format
3. Navigation routes are properly configured
4. Authentication middleware is applied to all routes

---

## üéØ Next Steps

After implementation:
1. Test the complete appointment booking flow
2. Configure email templates with your branding
3. Set up automated appointment reminders
4. Add calendar export functionality
5. Implement appointment rescheduling workflow
6. Add analytics for appointment metrics
7. Create admin dashboard for system monitoring

---

**Your medical calendar system is ready to launch! ‚öìüè¥‚Äç‚ò†Ô∏è**